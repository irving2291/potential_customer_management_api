[supervisord]
nodaemon=true

[program:php-fpm]
command=/usr/local/sbin/php-fpm --nodaemonize
stdout_logfile=/dev/stdout
stderr_logfile=/dev/stderr
autostart=true
autorestart=true
stopsignal=QUIT
stopwaitsecs=60

[program:nginx]
command=/usr/sbin/nginx -g "daemon off;"
stdout_logfile=/dev/stdout
stderr_logfile=/dev/stderr
autostart=true
autorestart=true
stopsignal=QUIT
stopwaitsecs=60

; === Worker de Messenger (RabbitMQ) ===
[program:consumer]
; Usa tu mismo comando; recomiendo sin time-limit fijo para que Supervisor recicle por memoria/limite
command=/usr/local/bin/php bin/console messenger:consume async -vv --memory-limit=256M --sleep=1 --no-interaction
directory=/var/www/html
stdout_logfile=/dev/stdout
stderr_logfile=/dev/stderr
autostart=true
autorestart=true
; App Runner env√≠a SIGTERM: con pcntl el worker termina el mensaje en curso y sale en graceful
stopsignal=TERM
stopwaitsecs=90
